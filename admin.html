<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudySpace - Admin Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .admin-table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; border-radius: 8px; overflow: hidden; }
        .admin-table th, .admin-table td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        .admin-table th { background: var(--primary-color); color: white; }
        .status-badge { padding: 5px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; }
        .status-pending { background: #fef3c7; color: #92400e; }
        .status-shipped { background: #dcfce7; color: #16a34a; }
    </style>
</head>
<body>
    <div class="container" style="padding: 50px 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h1><i class="fa-solid fa-lock"></i> Admin Order Manager</h1>
            <a href="index.html" class="btn btn-outline">Back to Shop</a>
        </div>

        <div id="admin-orders-list">
            <p>Loading orders from database...</p>
        </div>
        
        <div style="background: #f9fafb; padding: 25px; border-radius: 12px; margin-bottom: 40px; border: 1px solid #e5e7eb;">
    <h3><i class="fa-solid fa-plus-circle"></i> Add New Product</h3>
    <form id="add-product-form" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
        <input type="text" id="p-name" class="form-input" placeholder="Product Name" required>
        <input type="number" id="p-price" class="form-input" placeholder="Price (e.g. 29.99)" step="0.01" required>
        <select id="p-category" class="form-input">
            <option value="furniture">Furniture</option>
            <option value="bedding">Bedding</option>
            <option value="kitchen">Kitchen</option>
            <option value="storage">Storage</option>
        </select>
        <input type="text" id="p-image" class="form-input" placeholder="Image URL (Unsplash link)" required>
        <button type="submit" class="btn btn-primary" style="grid-column: span 2;">Upload to Shop</button>
    </form>
</div>
    </div>

    <script type="module" src="script.js"></script>
    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, collection, onSnapshot, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    // 1. YOUR ADMIN EMAIL (Change this!)
    const ADMIN_EMAIL = 'rajkumar.shrestha7025@gmail.com'; 

    const auth = getAuth();
    const db = getFirestore();
    const container = document.getElementById('admin-orders-list');

    // 2. CHECK IF USER IS ADMIN
    onAuthStateChanged(auth, (user) => {
        if (user && user.email === ADMIN_EMAIL) {
            // Authorized: Load the orders
            loadOrders();
        } else {
            // Unauthorized: Block access and redirect
            document.body.innerHTML = `
                <div style="text-align:center; padding:100px;">
                    <h1 style="color:red;">Access Denied</h1>
                    <p>Only the owner of StudySpace can view this page.</p>
                    <a href="index.html" class="btn btn-primary">Return Home</a>
                </div>
            `;
            setTimeout(() => { window.location.href = "index.html"; }, 3000);
        }
    });

    function loadOrders() {
        onSnapshot(collection(db, "orders"), (snapshot) => {
            if (snapshot.empty) {
                container.innerHTML = "<p>No orders yet. Keep marketing!</p>";
                return;
            }

            let html = `<table class="admin-table"><thead><tr><th>Student</th><th>Items</th><th>Total</th><th>Status</th><th>Action</th></tr></thead><tbody>`;

            snapshot.forEach((orderDoc) => {
                const order = orderDoc.data();
                const id = orderDoc.id;
                const itemList = order.items.map(i => i.name).join(', ');
                const statusClass = order.status === 'Shipped' ? 'status-shipped' : 'status-pending';

                html += `
                    <tr>
                        <td><strong>${order.customerName}</strong><br><small>${order.customerEmail}</small></td>
                        <td>${itemList}</td>
                        <td>$${order.subtotal.toFixed(2)}</td>
                        <td><span class="status-badge ${statusClass}">${order.status}</span></td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="updateOrderStatus('${id}', 'Shipped')">Mark Shipped</button>
                            <button class="btn btn-sm" style="color:red; background:none;" onclick="deleteOrder('${id}')"><i class="fa-solid fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            });
            html += `</tbody></table>`;
            container.innerHTML = html;
        });
    }

    // Global functions for buttons
    window.updateOrderStatus = async (id, newStatus) => {
        await updateDoc(doc(db, "orders", id), { status: newStatus });
        alert("Status updated!");
    };

    window.deleteOrder = async (id) => {
        if(confirm("Delete this record?")) await deleteDoc(doc(db, "orders", id));
    };

        import { addDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

// Logic to handle adding products
document.getElementById('add-product-form').onsubmit = async (e) => {
    e.preventDefault();
    const newProduct = {
        name: document.getElementById('p-name').value,
        price: parseFloat(document.getElementById('p-price').value),
        category: document.getElementById('p-category').value,
        image: document.getElementById('p-image').value
    };

    try {
        await addDoc(collection(db, "products"), newProduct);
        alert("Product added successfully!");
        e.target.reset();
    } catch (err) {
        alert("Error adding product: " + err.message);
    }
};
</script>
</body>
</html>
